# https://taskfile.dev

version: '3'

vars:
  BIN_NAME: "tingly-box"
  BIN_DIR: "bin"

tasks:
  # CLI build tasks for Linux (uses zig for cross-compilation with CGO)
  arm64:
    summary: Cross-compiles CLI for Linux ARM64 (requires zig)
    cmds:
      - task: cli:linux:arm64:cross

  arm64:cross:
    summary: Cross-compiles CLI for Linux ARM64 with zig
    deps:
      - task: check:zig
    cmds:
      - |
        mkdir -p {{.BIN_DIR}}
        # Use zig as cross-compiler for Linux ARM64
        CC="zig cc -target aarch64-linux-gnu" \
        CXX="zig c++ -target aarch64-linux-gnu" \
        GOOS=linux GOARCH=arm64 CGO_ENABLED=1 \
        go build -buildvcs=false -ldflags="-w -s" -o {{.BIN_DIR}}/{{.BIN_NAME}}-linux-arm64 ./cli/tingly-box
